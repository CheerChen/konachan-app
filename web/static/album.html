<html>
<head>
    <meta charset="utf-8">
    <meta name="referrer" content="never"/>
    <title>Konachan-app</title>
    <link rel="stylesheet" href="/web/static/bootstrap.min.css">

    <!-- Import PhotoSwipe Styles -->
    <link rel="stylesheet" href="/web/static/photoswipe.css">
    <link rel="stylesheet" href="/web/static/default-skin/default-skin.css">

    <link rel="shortcut icon" href="/web/static/favicon.ico"/>
    <link rel="bookmark" href="/web/static/favicon.ico"/>
    <!-- A touch of fanciness üíÑ -->
    <link href='https://fonts.font.im/css?family=Bitter:400,700,400italic' rel='stylesheet' type='text/css'>
    <style>
        body {
            background: #222;
            font-family: 'Bitter', Georgia, Times, sans-serif;
        }

        h1 {
            margin: 2em;
        }

        .pswp__caption__center {
            text-align: center;
        }

        figure {
            flex: 25%;
            max-width: 25%;
            padding: 0 4px;
        }

        img {
            margin-top: 8px;
            vertical-align: middle;
            width: 100%;
        }

        .spacer {
            height: 5em;
        }

        .gallery {
            display: flex;
            flex-wrap: wrap;
            padding: 0 4px;
        }

        /* Responsive layout - makes a two column-layout instead of four columns */
        @media screen and (max-width: 800px) {
            .column {
                flex: 50%;
                max-width: 50%;
            }
        }

        /* Responsive layout - makes the two columns stack on top of each other instead of next to each other */
        @media screen and (max-width: 600px) {
            .column {
                flex: 100%;
                max-width: 100%;
            }
        }

        .next_page {
            font-size: 12px;
        }

        .page-limits {
            font-size: 12px;
        }

        .prev_page {
            font-size: 12px;
        }

    </style>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-sm-12 col-sm-offset-0">

            <h1 class="text-center">
                Album
                <a href="/" title="To Posts">
                    <img style="width: 16px; height: 16px"
                         src="data:image/png;base64,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"
                         alt="Posts"/>
                </a>
                <br>
            </h1>
            <small>
                <select class="page-limits">
                    <option value="100">100p</option>
                    </option>
                    <option value="500">500p</option>
                </select>
                <a class="prev_page" rel="prev" href="javascript:;">‚Üê Prev</a>
                <a class="next_page" rel="next" href="javascript:;">Next ‚Üí</a>
            </small>

            <!-- Galley wrapper that contains all items -->
            <div id="gallery" class="gallery" itemscope itemtype="http://schema.org/ImageGallery">


            </div>

        </div>
    </div>
</div>

<!-- Some spacing üòâ -->
<div class="spacer"></div>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>

<!-- Import jQuery and PhotoSwipe Scripts -->
<script src="/web/static/jquery-2.1.1.min.js"></script>
<script src="/web/static/photoswipe.min.js"></script>
<script src="/web/static/photoswipe-ui-default.min.js"></script>

<script>
    'use strict';

    /* global jQuery, PhotoSwipe, PhotoSwipeUI_Default, console */


    (function ($) {

        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
        };

        // Init empty gallery array
        var container = [];

        // Loop over gallery items and push it to the array
        // $('h1').click(function (event) {
        let page = 1;
        if (getUrlParameter("page") != null) {
            page = getUrlParameter("page")
        }
        let limit = 100;
        if (getUrlParameter("limit") != null) {
            limit = getUrlParameter("limit")
            $(".page-limits").val(limit)
        }
        let url = `/album/${limit}/${page}/`;


        let tag = "";
        if (getUrlParameter("tag") != null) {
            tag = getUrlParameter("tag")
            url += tag;
            if (tag.length > 0) {
                $('h1').text(tag);
            }
        }

        function add2Tags(tag) {
            return `<a href="?page=1&tag=${encodeURIComponent(tag)}" target="_blank">${tag}</a>`;
        }

        $.getJSON(url, function (data) {
            $.each(data.data, function (i, item) {
                var ddaystrs = new Array();
                ddaystrs = item.tags.split(" ");

                let title = `<h4 class="all-copy">
<a href="https://konachan.com/post/show/${item.id}" target="_blank">${item.id}</a> - ${ddaystrs.map(add2Tags).join(" ")}
</h4><p>tfidf+ScoreÔºö${item.my_score} / tfidfÔºö${item.tf_idf} / ScoreÔºö${item.score} / ${item.width}x${item.height} /
<a href="/delete/${item.id}" target="_blank">Delete</a></p>`;
                let slideItem = {
                    msrc: `/preview/${item.id}`,
                    src: `/sample/${item.id}`,
                    w: item.width,
                    h: item.height,
                    title: title
                };
                container.push(slideItem);
                let figureHtml = `<figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
<a href="${slideItem.src}" data-caption="" data-width="${slideItem.w}" data-height="${slideItem.h}" itemprop="contentUrl">
<img src="${slideItem.msrc}" itemprop="thumbnail" alt="Image description"></a></figure>`
                $("#gallery").append(figureHtml);
            });

            // Define click event on gallery item
            $('.gallery a').click(function (event) {

                // Prevent location change
                event.preventDefault();

                // Define object and gallery options
                var $pswp = $('.pswp')[0],
                    options = {
                        index: $(this).parent('figure').index(),
                        bgOpacity: 0.85,
                        showHideOpacity: true,
                        closeOnScroll: false,
                        shareButtons: [
                            {id: 'download', label: 'Download image', url: '{{raw_image_url}}', download: true}
                        ],

                    };

                // Initialize PhotoSwipe
                var gallery = new PhotoSwipe($pswp, PhotoSwipeUI_Default, container, options);
                gallery.init();
            });


        });

        $('.next_page').click(function (event) {
            let l = window.location.href.split('?')[0]
            let page = 1;
            if (getUrlParameter("page") != null) {
                page = parseInt(getUrlParameter("page"));
            }
            page++;

            let tag = "";
            if (getUrlParameter("tag") != null) {
                tag = getUrlParameter("tag");
            }

            let limit = $(".page-limits").val();

            window.location.href = l + `?page=${page}&limit=${limit}&tag=${tag}`;
        });

        $('.prev_page').click(function (event) {
            let l = window.location.href.split('?')[0]
            let page = 1;
            if (getUrlParameter("page") != null) {
                page = parseInt(getUrlParameter("page"));
            }
            if (page > 1) {
                page--
            }

            let limit = $(".page-limits").val();

            let tag = "";
            if (getUrlParameter("tag") != null) {
                tag = getUrlParameter("tag");
            }
            window.location.href = l + `?page=${page}&limit=${limit}&tag=${tag}`;
        });

        $(".page-limits").change(function () {
            let l = window.location.href.split('?')[0]
            let page = 1;
            if (getUrlParameter("page") != null) {
                page = parseInt(getUrlParameter("page"));
            }

            let limit = $(".page-limits").val();

            let tag = "";
            if (getUrlParameter("tag") != null) {
                tag = getUrlParameter("tag");
            }

            window.location.href = l + `?page=${page}&limit=${limit}&tag=${tag}`;
        });

    }(jQuery));
</script>
</body>
</html>