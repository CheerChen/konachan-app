<html>
<head>
    <meta charset="utf-8">
    <meta name="referrer" content="never"/>
    <title>Konachan-app</title>

    <!-- Import PhotoSwipe Styles -->
    <link rel="stylesheet" href="/web/static/photoswipe.css">
    <link rel="stylesheet" href="/web/static/default-skin/default-skin.css">

    <link rel="shortcut icon" href="/web/static/favicon.ico"/>
    <link rel="bookmark" href="/web/static/favicon.ico"/>
    <!-- A touch of fanciness üíÑ -->
    <link href='https://fonts.font.im/css?family=Bitter:400,700,400italic' rel='stylesheet' type='text/css'>
    <style>
        body {
            background: #222;
            font-family: 'Bitter', Georgia, Times, sans-serif;
        }

        h1 {
            margin: 2em;
        }

        .pswp__caption__center {
            text-align: center;
        }

        figure {
            flex: 25%;
            max-width: 25%;
            padding: 0 4px;
        }

        img {
            margin-top: 8px;
            vertical-align: middle;
            width: 100%;
        }

        .spacer {
            height: 5em;
        }

        .gallery {
            display: flex;
            flex-wrap: wrap;
            padding: 0 4px;
        }

        /* Responsive layout - makes a two column-layout instead of four columns */
        @media screen and (max-width: 800px) {
            .column {
                flex: 50%;
                max-width: 50%;
            }
        }

        /* Responsive layout - makes the two columns stack on top of each other instead of next to each other */
        @media screen and (max-width: 600px) {
            .column {
                flex: 100%;
                max-width: 100%;
            }
        }

        .next_page {
            font-size: 12px;
        }

        .page-limits {
            font-size: 12px;
        }

        .prev_page {
            font-size: 12px;
        }

    </style>
</head>
<body>
<div class="container" id="app">
    <div class="row">
        <div class="col-sm-12 col-sm-offset-0">

            <h1 class="text-center">
                <a style="color: #333333;" href="/" title="To Posts" id="posts-h1">Posts</a> /
                <a style="color: #333333;" href="/album" title="To Album" id="album-h1">Album</a>
                <br>
            </h1>
            <small>
                <select class="page-limits">
                    <option value="100">100p</option>
                    </option>
                    <option value="500">500p</option>
                </select>
                <a class="prev_page" rel="prev" href="javascript:;">‚Üê Prev</a>
                <a class="next_page" rel="next" href="javascript:;">Next ‚Üí</a>
            </small>

            <!-- Galley wrapper that contains all items -->
            <div class="gallery">
                <figure v-for="(item, index) in slides">
                    <a :href="item.src" :data-caption="item.alt" :data-width="item.w"
                       :data-height="item.h">
                        <img :src="item.msrc" :alt="item.alt" :style="[item.fav ? 'opacity:0.1': '']">
                    </a>
                </figure>
            </div>

        </div>
    </div>
</div>

<!-- Some spacing üòâ -->
<div class="spacer"></div>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>

<!-- Import jQuery and PhotoSwipe Scripts -->
<script src="/web/static/photoswipe.min.js"></script>
<script src="/web/static/photoswipe-ui-default.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>
    function add2Tags(tag) {
        return `<a href="?page=1&tag=${encodeURIComponent(tag)}" target="_blank">${tag}</a>`;
    }

    var app = new Vue(
        {
            el: '#app',
            data: {
                limit: 100,
                page: 1,
                tag: "",
                slides: [],
            },
            methods: {
                loadPhotoswipe: function (event) {
                    let $pswp = $('.pswp')[0];
                    let options = {
                        index: event.target.index(),
                        bgOpacity: 0.85,
                        showHideOpacity: true,
                        closeOnScroll: false,
                        shareButtons: [
                            {id: 'download', label: 'Download image', url: '{{raw_image_url}}', download: true}
                        ],

                    };

                    // Initialize PhotoSwipe
                    var gallery = new PhotoSwipe($pswp, PhotoSwipeUI_Default, this.slides, options);
                    gallery.init();
                }
            },
            mounted() {
                // var that = this
                axios.get(`/remote/${this.limit}/${this.page}/${this.tag}`)
                    .then( (response) => {
                        console.log(response)
                        response.data.data.forEach((item) => {
                            let ddaystrs = item.tags.split(" ");

                            let title = `<h4 class="all-copy">
<a href="https://konachan.com/post/show/${item.id}" target="_blank">${item.id}</a> - ${ddaystrs.map(add2Tags).join(" ")}
</h4><p>tfidf+ScoreÔºö${parseFloat(item.my_score).toFixed(4)} / tfidfÔºö${parseFloat(item.tf_idf).toFixed(4)}
/ ScoreÔºö${item.score} / Disp: ${item.width}x${item.height} / Size: ${item.size} / Rate: ${item.rating}</p>
<a href="/download/${item.id}" target="_blank">Download</a></p>`;
                            if (item.is_fav) {
                                title += `<a href="/delete/${item.id}" target="_blank">Delete</a>`;
                            }
                            let slideItem = {
                                msrc: item.preview_url,
                                src: item.sample_url,
                                w: item.sample_width,
                                h: item.sample_height,
                                title: title,
                                alt: item.tags,
                                fav: item.is_fav,
                            };
                            this.slides.push(slideItem);
                        });

                        console.log(response);
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            }
        }
    )
</script>

</body>
</html>